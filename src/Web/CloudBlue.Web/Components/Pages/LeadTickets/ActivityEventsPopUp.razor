@using CloudBlue.Domain.DomainModels
@inject DialogService DialogService

<style>
    .rz-row {
        margin-bottom: 0px !important;
        margin-top: 0px !important;
    }
</style>


<RadzenStack Gap="0.25rem">
    <Spinners></Spinners>


    <RadzenTemplateForm TItem="LeadTicketActionModel" Data="@_model" Submit="@ApplyAction">
        <RadzenFieldset AllowCollapse="false">

            <ChildContent>
                <RadzenRow AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center">


                    <RadzenColumn Size="12" SizeMD="8">


                        <RadzenDataGrid Style="height: 110px" GridLines="DataGridGridLines.Both" Data="@_results" @ref="_grid"
                                        Count="@_results.Count" TItem="EntityActionResult">

                            <Columns>
                                <RadzenDataGridColumn TextAlign="TextAlign.Center" Width="20%" Filterable="false" Sortable="true" TItem="EntityActionResult" Property="@nameof(EntityActionResult.ItemId)" Title="Id">

                                </RadzenDataGridColumn>
                                <RadzenDataGridColumn TextAlign="TextAlign.Center" TItem="EntityActionResult" Filterable="false" Visible="@_isResponse" Property="@nameof(EntityActionResult.ActionResult)" Sortable="true" Title="Applicable" Width="20%">
                                    <Template Context="bulkActionResult">
                                        @{
                                            var path = $"/images/{bulkActionResult.ActionResult}.png";
                                        }

                                        <RadzenImage Style="height: 20px; width: 20px;" Path="@path"></RadzenImage>


                                    </template>
                                </RadzenDataGridColumn>

                                <RadzenDataGridColumn TextAlign="TextAlign.Center" Width="60%" TItem="EntityActionResult" Filterable="false" Property="@nameof(EntityActionResult.Message)" Sortable="true" Title="Notes">
                                    <Template Context="bulkActionResult">
                                        @{
                                            var badgeStyle = _isResponse ? bulkActionResult.ActionResult ? BadgeStyle.Success : BadgeStyle.Danger : bulkActionResult.ActionResult ? BadgeStyle.Info : BadgeStyle.Warning;
                                        }
                                        
                                        <RadzenBadge Shade="Shade.Lighter" BadgeStyle="@badgeStyle"   Text="@bulkActionResult.Message"/> 
                                        

                                    </Template>
                                </RadzenDataGridColumn>


                            </Columns>


                        </RadzenDataGrid>
                    </RadzenColumn>


                </RadzenRow>


            </ChildContent>
        </RadzenFieldset>


        <RadzenFieldset AllowCollapse="false">

            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.25rem">

                    <b>
                        <span class="titleSpan">@SubTitle</span>
                    </b>
                </RadzenStack>
            </HeaderTemplate>

            <ChildContent>


                <RadzenRow JustifyContent="JustifyContent.Center" lignItems="AlignItems.Center">

                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="" Variant="Variant.Outlined" Style="width: 100%;">

                            <RadzenDropDown AllowClear="true" Change="FeedBackTypeChanged"  Name="ContactingTypeId" @bind-Value="@_model.ContactingTypeId" Data="@_feedbackItems" TextProperty="ItemName" ValueProperty="ItemId" Placeholder="Select One" Style="width: 100%;"/>
                            <RadzenDataAnnotationValidator Popup="true" Style="position: absolute" Component="ContactingTypeId" ComponentProperty="Value"/>

                        </RadzenFormField>


                    </RadzenColumn>
                    <RadzenColumn Size="12" Visible="@IsReminder" SizeMD="6">
                        <RadzenFormField Text="Date & Time" Variant="Variant.Outlined" Style="width: 100%;">

                            <RadzenDatePicker Name="ReminderDate" @bind-Value="@_model.ReminderDate"  AllowClear="true"  AllowInput="false"  Style="width: 100%;" ShowTime="true" Format="dd/MM/yyyy HH:mm"/>

                            <RadzenDataAnnotationValidator Popup="true" Style="position: absolute" Component="ReminderDate" ComponentProperty="Value"/>

                        </RadzenFormField>


                    </RadzenColumn>

                </RadzenRow>
                <RadzenRow JustifyContent="JustifyContent.Center" lignItems="AlignItems.Center">
                    <RadzenColumn Size="12" SizeMD="12">
                        <RadzenFormField Text="Notes" Variant="Variant.Outlined" Style="width: 100%;">
                            <RadzenTextArea Name="Notes" @bind-Value="@_model.Comment" Style="width: 100%;" Multiline="true" Rows="3"/>
                            <RadzenDataAnnotationValidator Popup="true" Style="position: absolute" Component="Notes" ComponentProperty="Value"/>
                        </RadzenFormField>

                    </RadzenColumn>
                </RadzenRow>

            </ChildContent>
        </RadzenFieldset>


        <RadzenRow JustifyContent="JustifyContent.Center" lignItems="AlignItems.Center" Style="margin-top: 20px !important">
            <RadzenButton ButtonType="ButtonType.Submit" Disabled="@_isResponse" Text="Apply" Style="width: 80px;"/>
            <RadzenButton Text="Close" Click="@Close" ButtonStyle="ButtonStyle.Light"/>
        </RadzenRow>


    </RadzenTemplateForm>
</RadzenStack>